begin;
WITH vals AS(VALUES('Tile 1567:'),('.####.##.#'),('.......#..'),('.###..###.'),('.....#..#.'),('..#....#..'),('#......###'),('#..#.....#'),('#....##...'),('...###...#'),('#.#.#..##.'),(''),('Tile 3313:'),('.#.#......'),('#...#.....'),('#...##....'),('#....#.#..'),('.....###..'),('#.##.##...'),('..#.#####.'),('....#..#.#'),('#########.'),('..#.#.##..'),(''),('Tile 1181:'),('#.........'),('.##.....##'),('...#..##.#'),('#......#..'),('#...#...#.'),('.#.#.....#'),('.#...##...'),('..###...##'),('...#...#..'),('.##..#..##'),(''),('Tile 3967:'),('.#.#.#....'),('#.........'),('#..#..#...'),('.##......#'),('###.....#.'),('.##..#....'),('#...#...#.'),('...#......'),('#....#.#..'),('#.##......'),(''),('Tile 1913:'),('.######..#'),('#......##.'),('........##'),('..#.......'),('###......#'),('.#..#.####'),('.....#..##'),('#...#.....'),('##........'),('#.#.##.###'),(''),('Tile 2593:'),('..#..#.##.'),('#.#....#.#'),('#..#..#..#'),('##....##.#'),('#.....#..#'),('#..##.....'),('....#....#'),('#...#.#.#.'),('.......#.#'),('##..###...'),(''),('Tile 3709:'),('#...######'),('###.#.#..#'),('.##..##...'),('...#......'),('#.##....##'),('#.#......#'),('.#.###..#.'),('.........#'),('.....##..#'),('.#.##.##..'),(''),('Tile 1823:'),('##.##..#.#'),('#...#.....'),('#...#....#'),('.#...#.#..'),('###..#..##'),('.#.##...#.'),('#..#..#..#'),('##...#.#..'),('#.#.#.#...'),('.#.#...##.'),(''),('Tile 3371:'),('.##.##.###'),('.#.......#'),('....#..#.#'),('#..#.#..#.'),('#..#.#.#..'),('.#....##..'),('##.###....'),('..#.##.#..'),('###.#.###.'),('....#.###.'),(''),('Tile 2309:'),('##.....###'),('##........'),('##....#..#'),('.#.#.#...#'),('..........'),('...##..#..'),('#....#...#'),('#....#...#'),('#.##.##..#'),('.#.#.####.'),(''),('Tile 1451:'),('.###.#.#.#'),('##...#.#..'),('#...#.#...'),('.##......#'),('.........#'),('......#...'),('##......#.'),('.......#..'),('...##.#.##'),('#.##....##'),(''),('Tile 2549:'),('##..#...##'),('..#..#...#'),('#.##...#..'),('....#..##.'),('...##.....'),('#..#......'),('#..###....'),('.#.......#'),('...###.#..'),('#.#####...'),(''),('Tile 1861:'),('#...#..#..'),('#.#....#..'),('#..#...###'),('#....##...'),('#.....##..'),('#........#'),('##.......#'),('....###...'),('#....#...#'),('.##.#.#.#.'),(''),('Tile 2897:'),('..###.....'),('##.#.#.#.#'),('.#.......#'),('..#.#....#'),('##.##.#...'),('..#.###...'),('.##......#'),('...#...#..'),('#.#......#'),('#..###..##'),(''),('Tile 3833:'),('##...#.#..'),('#..#.#..##'),('.#...#.###'),('#........#'),('##.##....#'),('##...#.#.#'),('#.........'),('....#..#..'),('#......#..'),('....##..##'),(''),('Tile 2389:'),('..##.#####'),('#...##.#.#'),('..#...#.##'),('##.#..#..#'),('#..#.#....'),('#.#..##...'),('#......#..'),('......#...'),('..#.###...'),('.#######..'),(''),('Tile 1549:'),('...##.##..'),('..........'),('..#...##..'),('.###.#..#.'),('.#..####..'),('##..#..###'),('..#.###...'),('.#.......#'),('...####...'),('#....#...#'),(''),('Tile 2671:'),('#..#.....#'),('###.#.....'),('#...#...#.'),('..#.##.#..'),('..###.##..'),('###.#...#.'),('#..##..#..'),('#..###...#'),('...#......'),('.#....##.#'),(''),('Tile 2339:'),('.##..###.#'),('.#.#...##.'),('.#.#......'),('..##......'),('.#.#.#...#'),('.##....##.'),('#....##...'),('#.#...#..#'),('..#.....##'),('..####.###'),(''),('Tile 3163:'),('.##.#...#.'),('...##....#'),('.#.#.#...#'),('#...#..##.'),('....#..#.#'),('#..#.#....'),('..#......#'),('..#..#...#'),('#....#.#.#'),('###..####.'),(''),('Tile 1699:'),('.....####.'),('#..#...#..'),('##....####'),('...##..#..'),('...#...###'),('##....#.##'),('###......#'),('..#.###.#.'),('.#.....#.#'),('.#.#..##.#'),(''),('Tile 3701:'),('.#..#.##.#'),('.##.......'),('.#.#.#..##'),('...#.#...#'),('.........#'),('#.##..#...'),('.##.##.##.'),('....#.#.##'),('.###.....#'),('##.######.'),(''),('Tile 3547:'),('.##..###..'),('#...#..#.#'),('#....#....'),('....###..#'),('#.##..##..'),('....#...#.'),('......#..#'),('...#......'),('..#....#.#'),('##.#.#.#.#'),(''),('Tile 2543:'),('...#.#....'),('.....#...#'),('#........#'),('....#.#...'),('...#..#.##'),('###..#...#'),('#..###..#.'),('#..##....#'),('.#..#....#'),('###.#..#.#'),(''),('Tile 3299:'),('##.#..###.'),('##........'),('.......#..'),('#.........'),('##.......#'),('..##...##.'),('.#..##.#.#'),('.##.#...##'),('..#..#.#.#'),('.##.#.#..#'),(''),('Tile 2371:'),('..#...###.'),('#.#......#'),('.##.....#.'),('..#...#.#.'),('#.#.#.....'),('.#......##'),('..........'),('.......#.#'),('#.....#.#.'),('..#####.##'),(''),('Tile 2441:'),('...##.#...'),('#.....##..'),('#.#.#..#..'),('#...###.#.'),('##.......#'),('#......#.#'),('##...#..##'),('#....#.##.'),('#...#.##.#'),('##.##.####'),(''),('Tile 3209:'),('#.#.##..##'),('#.....##..'),('.........#'),('........##'),('#..#....##'),('...###...#'),('..#......#'),('#....#..#.'),('###.#.##.#'),('##.#.#####'),(''),('Tile 2521:'),('##..#....#'),('#.........'),('...#...##.'),('##.#.#...#'),('......#..#'),('....#.#..#'),('....##...#'),('.........#'),('...#......'),('..##.....#'),(''),('Tile 2819:'),('...##..#..'),('.#........'),('..#....#.#'),('##...#...#'),('##.#.....#'),('....#....#'),('..#.....##'),('#..#...###'),('...##...##'),('#.##.##..#'),(''),('Tile 1811:'),('.#..#.....'),('###.##...#'),('#.#.......'),('#........#'),('...#.##...'),('.##......#'),('.####..#.#'),('#....##..#'),('.#....##..'),('.#..#.##..'),(''),('Tile 3169:'),('##.##.####'),('.....#..#.'),('..........'),('##.##.....'),('.#...#..#.'),('#..#...#..'),('#....#.##.'),('##.......#'),('#.....###.'),('########.#'),(''),('Tile 3079:'),('.#..###.##'),('##..##...#'),('#.#..##.##'),('##..#.....'),('......#...'),('..#...#.#.'),('#..#.#...#'),('##.....##.'),('.....#.#..'),('......#...'),(''),('Tile 1187:'),('###...##.#'),('#.........'),('.##...##..'),('#..#......'),('.#.#.....#'),('####....#.'),('...#......'),('.....#..##'),('.##......#'),('#.#####.##'),(''),('Tile 2243:'),('###.##.#..'),('....#.#.#.'),('#.###....#'),('.#....###.'),('#....##..#'),('#...##...#'),('#...##...#'),('###.##..##'),('........#.'),('#.#.######'),(''),('Tile 2887:'),('#.##.###.#'),('#...#....#'),('..#.......'),('#..##.#.##'),('##..#.##..'),('#.........'),('....#...#.'),('#....#....'),('#####.#..#'),('..#######.'),(''),('Tile 2063:'),('###.###..#'),('##...#...#'),('..###.....'),('#...#.##..'),('.#.......#'),('##...#....'),('.##.#.##.#'),('.##.......'),('#.........'),('######.#.#'),(''),('Tile 1609:'),('##..##.##.'),('.#.#...##.'),('#........#'),('#....#...#'),('.#......##'),('..#......#'),('#...#.....'),('.#........'),('...#.....#'),('..#.###...'),(''),('Tile 1039:'),('.####.#.##'),('#......##.'),('...#.#.#..'),('##..##....'),('##.#...#..'),('###....###'),('....##....'),('..##......'),('#...#.....'),('..#..#.##.'),(''),('Tile 3697:'),('#..#.#####'),('#......#..'),('#.........'),('.....#...#'),('#...###...'),('#.......#.'),('..##....#.'),('..#.##..#.'),('#...##...#'),('.##.#.##.#'),(''),('Tile 1601:'),('##.###..#.'),('.#..#.....'),('...#......'),('#...###...'),('#...#..#..'),('...#.#..#.'),('..##...#.#'),('.#........'),('..##.#...#'),('#..#...##.'),(''),('Tile 1019:'),('.#.##.#..#'),('#....#.###'),('#...##.#..'),('.#..###.#.'),('.#......##'),('...#..###.'),('##....#..#'),('#.......#.'),('....###..#'),('.###.###.#'),(''),('Tile 3449:'),('.##....#..'),('.........#'),('..#...#.##'),('##......#.'),('.......##.'),('#....#....'),('#....#..##'),('##......#.'),('##..#.#..#'),('#.#.#.##.#'),(''),('Tile 2383:'),('#####.##..'),('..#...#.#.'),('..##...#.#'),('.#...##.#.'),('##....#..#'),('##..#.###.'),('.#.....#..'),('#...#....#'),('#.#....#.#'),('#.##....#.'),(''),('Tile 3083:'),('##.#...#.#'),('.#...#....'),('....##..##'),('.##.#.#..#'),('#....#.#.#'),('##.###...#'),('#..##....#'),('#..#.#...#'),('#.#.#.#...'),('.##.#...#.'),(''),('Tile 1237:'),('..#.######'),('..#..#.###'),('......#.#.'),('#...#..#.#'),('##.....##.'),('#####..#.#'),('.#.#.##..#'),('.#..#....#'),('......#...'),('.#.##...##'),(''),('Tile 2837:'),('.#.#..#..#'),('..#....#.#'),('###..#....'),('#.#..#....'),('#.###....#'),('..##..#...'),('##.##..#.#'),('#...##....'),('......#.#.'),('##.#.....#'),(''),('Tile 1709:'),('###.##...#'),('.#...##..#'),('##.####.##'),('#..##...##'),('#..#....##'),('#.#...#...'),('###.......'),('#...#....#'),('#.........'),('##....###.'),(''),('Tile 2657:'),('#.##..##..'),('....#.#...'),('#...#.....'),('..##..####'),('.#.......#'),('##......##'),('..#.#.#..#'),('...#.....#'),('#..#......'),('#.##..#...'),(''),('Tile 1091:'),('##.###...#'),('..###...#.'),('#.#....#.#'),('##...#..##'),('#...#.....'),('.....#...#'),('..#......#'),('...###.#..'),('.##.#....#'),('#....#####'),(''),('Tile 1259:'),('.#.#.....#'),('#.#.##.###'),('.#.#.#..#.'),('#..##.....'),('#...#...#.'),('#....#.#.#'),('#....##...'),('.#........'),('...###..##'),('..#.#####.'),(''),('Tile 1409:'),('#.###.#..#'),('.#....#..#'),('#.........'),('..........'),('##...#...#'),('##.#....##'),('.....#....'),('#........#'),('###..#.#..'),('..#..#.###'),(''),('Tile 2539:'),('####...#.#'),('#...###..#'),('.##.##...#'),('#..##..#..'),('.##.#..#.#'),('#..#####..'),('#....#...#'),('.....#..##'),('#..#..#..#'),('..#...#...'),(''),('Tile 3343:'),('#..#....##'),('#..#....#.'),('.#.#...##.'),('.#...###..'),('.#.#....#.'),('..........'),('#........#'),('#..#....##'),('###.##....'),('.##..#..##'),(''),('Tile 1471:'),('.#.##.#.##'),('#...#....#'),('#.#....###'),('#.#..#..#.'),('...##..##.'),('##.##...#.'),('#..#.#.#..'),('#.##...#..'),('........##'),('..####.#..'),(''),('Tile 3571:'),('..##.####.'),('...#....#.'),('....##..#.'),('....#.##..'),('####.....#'),('..#..#....'),('...#......'),('##.#....#.'),('....#....#'),('#....##...'),(''),('Tile 1637:'),('#..##.#...'),('.#....#...'),('.......#..'),('#...##....'),('#...##...#'),('#..#.....#'),('.#.##.....'),('.##.....##'),('###.###..#'),('.#.##..###'),(''),('Tile 2293:'),('..#..##.#.'),('#.##......'),('....#...#.'),('#.##...#.#'),('##..#.....'),('.........#'),('........##'),('#....#...#'),('#..##..#.#'),('#.#.###..#'),(''),('Tile 2099:'),('...#.#..##'),('....#.....'),('#.#....##.'),('.....##...'),('#.##......'),('.......###'),('..#######.'),('......#..#'),('#...#....#'),('###.#..##.'),(''),('Tile 1499:'),('...#..####'),('#.#..#.#..'),('###......#'),('##.....#.#'),('..#..#...#'),('.#..#.#...'),('..#......#'),('#.###...#.'),('####.....#'),('#.#.......'),(''),('Tile 3853:'),('.#.###.###'),('......#..#'),('#.#....#..'),('#....#.#.#'),('#..##.....'),('.#.....#..'),('......##.#'),('#.#.#.....'),('#.........'),('##.####...'),(''),('Tile 1423:'),('.#########'),('##...#.#.#'),('##......##'),('#.........'),('##...#..##'),('..#.#.#.##'),('......#...'),('.#.##.....'),('....##...#'),('###...##..'),(''),('Tile 2351:'),('##.....###'),('...#.##.#.'),('.###..##..'),('.#..#....#'),('#...##..##'),('#...#.##..'),('#..#.....#'),('.#...#....'),('......##..'),('..#.#.####'),(''),('Tile 3739:'),('.##.#.....'),('.#..#...##'),('#.........'),('#.#..##.#.'),('.#...###..'),('#.....#.##'),('#.......#.'),('##...#...#'),('...###.#.#'),('.#...#.#.#'),(''),('Tile 2699:'),('..#.#..###'),('##.......#'),('#####.#...'),('##..#.#.##'),('##..#.....'),('..#.......'),('.##..##...'),('...#......'),('##.#......'),('#..##.#...'),(''),('Tile 1301:'),('##..#.####'),('...#.....#'),('#.#..#...#'),('#.......#.'),('..#..#....'),('....#.....'),('....##.##.'),('#...##....'),('#..#.....#'),('.#.######.'),(''),('Tile 2579:'),('#.#.###.##'),('.#........'),('....#....#'),('#...#.....'),('#..#....##'),('###.#####.'),('#.#.#.##..'),('#.....#...'),('...#...#..'),('#.#..#...#'),(''),('Tile 2621:'),('#.#.#..#..'),('#..#......'),('...##.#...'),('..#..#..##'),('.......###'),('#.....####'),('.....#...#'),('##....##.#'),('##......#.'),('..#.#..#.#'),(''),('Tile 3407:'),('.###.##.##'),('#......#..'),('#.#......#'),('#...#...##'),('####..##..'),('####...#.#'),('.#..#...#.'),('##.#.....#'),('..#....#.#'),('.#....#.##'),(''),('Tile 1583:'),('....#.#.##'),('..#.....##'),('#........#'),('#....#...#'),('#....#....'),('..#.#.....'),('#....###.#'),('...#.##...'),('#...##....'),('##..###...'),(''),('Tile 2659:'),('..###..#.#'),('.....#.#..'),('##.....##.'),('##....#...'),('..##..#...'),('.##.....#.'),('##.....###'),('..##.....#'),('##.##.....'),('.....###.#'),(''),('Tile 1117:'),('#..######.'),('#....##.##'),('##.......#'),('....#.....'),('#..#...#.#'),('##....#...'),('....#.##..'),('....#.#..#'),('.#.#####.#'),('..##.....#'),(''),('Tile 2029:'),('#.#.#.##.#'),('##..#..#..'),('#.##.#..##'),('.#......##'),('#......#..'),('#...#.....'),('..#.##...#'),('#.........'),('..##.##..#'),('#.#.##.##.'),(''),('Tile 2879:'),('...#.#.#..'),('...#.#...#'),('.....#...#'),('#.......##'),('####.....#'),('##..#..#..'),('.......###'),('#.#.#.#..#'),('#.......#.'),('......##.#'),(''),('Tile 1877:'),('#...##.#..'),('#...#..#..'),('..#.......'),('.#.#..#..#'),('#.#...#..#'),('.#..#.##.#'),('..##.#..#.'),('.#.#...#..'),('.#..#....#'),('#.#.####..'),(''),('Tile 3541:'),('####...##.'),('........##'),('#..#.##...'),('...##...#.'),('#.#..#....'),('...#...#..'),('.####..#.#'),('.....#..##'),('......#...'),('.#...#....'),(''),('Tile 3889:'),('##..#.##..'),('.#...##..#'),('###..##..#'),('##....#...'),('#.#.#.##..'),('..#.#.##..'),('#.#...#.##'),('..#..##...'),('#..#.#...#'),('.#..##.##.'),(''),('Tile 1373:'),('....#####.'),('#.#..#....'),('#....#....'),('#.....#..#'),('###.##.###'),('......#...'),('...#.....#'),('.#.##..#..'),('..###.####'),('#######.#.'),(''),('Tile 3251:'),('#.#.#.#...'),('#..#.#....'),('.....##.#.'),('.....##.#.'),('........##'),('....#...#.'),('...#...#.#'),('##......#.'),('..##......'),('..###.####'),(''),('Tile 3907:'),('##.#...###'),('....#.####'),('..........'),('.......###'),('##..#...##'),('...#...#.#'),('...###....'),('.......###'),('#......#.#'),('#..#.##...'),(''),('Tile 3191:'),('#.####...#'),('##...##...'),('##.#.##...'),('##.##.....'),('.#.....#.#'),('#.###.....'),('#.........'),('.....#...#'),('##.#......'),('.##.#..###'),(''),('Tile 1201:'),('#.#.#####.'),('...#......'),('.#....##.#'),('.#.......#'),('.#..#.....'),('...##.....'),('..........'),('.#....#..#'),('#.#..###..'),('##...###.#'),(''),('Tile 1873:'),('##..#.....'),('##....#..#'),('..........'),('....##.##.'),('##......#.'),('......#...'),('#..#.#...#'),('....#..#.#'),('##.....###'),('.###.#..##'),(''),('Tile 3373:'),('.#.#.#.##.'),('#.#.##.##.'),('#.###...#.'),('..##...##.'),('....#....#'),('....#.#.#.'),('.#.#.....#'),('####..#.##'),('..#..#..##'),('.##.###.#.'),(''),('Tile 2903:'),('....##...#'),('#........#'),('#....#..#.'),('.......#..'),('#.#.......'),('....#...##'),('##..##...#'),('####...#.#'),('.#...#.###'),('#.#..###..'),(''),('Tile 1933:'),('.##..#.#..'),('#..##....#'),('.....#....'),('#..#.#..##'),('#..####...'),('#..###.#..'),('..##......'),('#..#.#....'),('#.........'),('##.##.#.##'),(''),('Tile 2083:'),('#.#...####'),('##..#.##.#'),('.........#'),('.....#.###'),('..#.......'),('.##..#..##'),('.#..#.....'),('...#....#.'),('......#.##'),('.##.##...#'),(''),('Tile 1453:'),('#.......#.'),('#.#.....#.'),('#.#..##...'),('...#..#...'),('##..###...'),('.......###'),('##.##.#..#'),('...##.....'),('#.#..#...#'),('..##.##.##'),(''),('Tile 3229:'),('##..#.###.'),('....#...#.'),('..#.##..#.'),('##..##.##.'),('...###...#'),('####.#....'),('.....###.#'),('.....#....'),('...#.....#'),('..##.#..##'),(''),('Tile 1279:'),('#..#.####.'),('.#......##'),('##..#..#..'),('..##.#.##.'),('#.#.......'),('.....#....'),('#.##..##..'),('....#...##'),('##..#....#'),('..##....#.'),(''),('Tile 2531:'),('#.###.#.##'),('#.#......#'),('..........'),('.##.##....'),('###..#....'),('#........#'),('#..#...#..'),('#.......#.'),('#.#.....#.'),('#.##.#....'),(''),('Tile 1153:'),('...#..##..'),('...#......'),('##.###..##'),('#.#.#.####'),('...#.#...#'),('.....#....'),('##...#...#'),('#...#...##'),('....#.###.'),('##.##.##.#'),(''),('Tile 3413:'),('...##.##.#'),('#.#......#'),('...#.#.#.#'),('.#....#.#.'),('....#.#.#.'),('....##..##'),('.#..#....#'),('#........#'),('..........'),('##.#..##.#'),(''),('Tile 1879:'),('...##..###'),('........##'),('#.........'),('...#.##...'),('####...###'),('####.#...#'),('.##..###.#'),('#....#...#'),('#........#'),('#.###..###'),(''),('Tile 1831:'),('...#.#....'),('....#..#.#'),('..##.#..##'),('..##.....#'),('###...#..#'),('#####.##.#'),('.....#....'),('..........'),('##........'),('...#.##...'),(''),('Tile 1151:'),('.#.##.###.'),('.#....##.#'),('.....##.#.'),('#.........'),('.####.#..#'),('.#....#...'),('...#..#...'),('.##..#.#..'),('.##....#.#'),('##.#.##...'),(''),('Tile 3037:'),('#...####.#'),('#..#.#...#'),('....#.#..#'),('#.#.......'),('.......#..'),('....#.##..'),('..#...#..#'),('#...#....#'),('.##.....#.'),('.#..#.##.#'),(''),('Tile 1297:'),('#.####.#..'),('...##.#..#'),('..#..#..##'),('#..#......'),('..........'),('#.........'),('##...#.#..'),('.#.......#'),('#..#....##'),('.####.#.##'),(''),('Tile 2417:'),('##.#..#.#.'),('#.#..#.#..'),('......#..#'),('#.....#...'),('.#...#....'),('#.........'),('#...#....#'),('###..#...#'),('##....#.#.'),('###.####..'),(''),('Tile 1009:'),('..#...#.##'),('....##....'),('.#.###....'),('##...#....'),('##....#.#.'),('.#...#.#.#'),('#.##..##..'),('#.....##.#'),('..#.###...'),('...##....#'),(''),('Tile 2939:'),('..##.####.'),('##..#....#'),('....#...#.'),('...#...#.#'),('#..##.#...'),('..#.#.#..#'),('#.....#...'),('#.#....###'),('####....#.'),('.###.#.#.#'),(''),('Tile 1979:'),('..###...##'),('#.....#.#.'),('.#..##.###'),('..##..#...'),('.........#'),('..........'),('###...#...'),('#.....#..#'),('#.........'),('####.###..'),(''),('Tile 3041:'),('####.....#'),('##.#.##..#'),('###..#####'),('.#....####'),('...#...#.#'),('...#..#..#'),('.#.....#..'),('.####.#.##'),('.......#.#'),('.......##.'),(''),('Tile 1289:'),('.#.#.###..'),('##...#....'),('#.....#...'),('..##...#.#'),('#.#....#..'),('#.#...#...'),('#......###'),('#..#.#.##.'),('#..#.##..#'),('......#..#'),(''),('Tile 2917:'),('#.###.####'),('..#....#.#'),('...#......'),('........#.'),('#........#'),('..#...#...'),('.....##...'),('..###....#'),('######..#.'),('#.........'),(''),('Tile 3767:'),('###.#.#.#.'),('#..#.....#'),('.#..#....#'),('#..###...#'),('#...#....#'),('..#....###'),('..##......'),('#.....#..#'),('.........#'),('.#..#.#...'),(''),('Tile 1777:'),('#.#.###.##'),('......#...'),('#........#'),('..#..#....'),('###..###..'),('#..#.#...#'),('#...#..#..'),('#...##....'),('.##.#.....'),('..##.#.#..'),(''),('Tile 1217:'),('#.#..#..##'),('#.##..#..#'),('#...#....#'),('##.......#'),('##..#..#.#'),('.......###'),('.....#....'),('..#..##.#.'),('...#.#.#..'),('#.#...#.##'),(''),('Tile 1277:'),('....####.#'),('.....##.#.'),('......#...'),('........#.'),('#...###.#.'),('##.#..#.#.'),('....##.#.#'),('.....#.#..'),('#....#....'),('.#...###..'),(''),('Tile 3319:'),('.#..###...'),('...#......'),('#.#..#..#.'),('.........#'),('.........#'),('.#.#.....#'),('........#.'),('......#..#'),('.....#.#.#'),('.###..##..'),(''),('Tile 2609:'),('##.#####..'),('.#.......#'),('#...#.#...'),('.#.......#'),('#.##.....#'),('#...#.#...'),('##.#...#..'),('.#......#.'),('#.......#.'),('..#.####..'),(''),('Tile 3109:'),('.##.######'),('.##.#...#.'),('..........'),('#.##.#.#.#'),('##.#..##..'),('##...##..#'),('..##.###.#'),('..........'),('.#....#...'),('.#.#.##..#'),(''),('Tile 3347:'),('..#.#.#...'),('#.....#.#.'),('.#...#...#'),('#....#..#.'),('.........#'),('.#.#.##..#'),('###...#.#.'),('#.....#.#.'),('...#.#....'),('..#.#..###'),(''),('Tile 1489:'),('#......#..'),('#..#.....#'),('..##.....#'),('.##.###...'),('.....#.#..'),('#.........'),('..#....###'),('........#.'),('.........#'),('..#.###.##'),(''),('Tile 3631:'),('##...#..##'),('.#.#.#...#'),('#.....#..#'),('.#.#.#####'),('...#.#.#..'),('#..#.###.#'),('#.#......#'),('..#.......'),('#.....#.#.'),('##........'),(''),('Tile 3527:'),('...##..#..'),('........##'),('....#....#'),('#....#..#.'),('#..#.....#'),('#..#.#.#..'),('.#........'),('.#.....#.#'),('.....#...#'),('#.#.......'),(''),('Tile 3917:'),('#.....####'),('##....###.'),('#....##..#'),('#..#...#..'),('..##......'),('#.##..####'),('.#.##..#..'),('#.#..#...#'),('...#.....#'),('...##..#.#'),(''),('Tile 2789:'),('..#...#...'),('##....##.#'),('.##.....##'),('..#..##.#.'),('....######'),('.#.#.#...#'),('#...#...#.'),('........#.'),('......#.##'),('.##.#..##.'),(''),('Tile 1223:'),('#.....#..#'),('#..##.....'),('....#.....'),('#....#..##'),('##.....#.#'),('#.#.....#.'),('....#..#.#'),('..#.....##'),('.##..#.##.'),('.#...###..'),(''),('Tile 2221:'),('##..#.#.#.'),('..........'),('.......###'),('.......###'),('##......##'),('....##..#.'),('#....#...#'),('#....####.'),('#....#####'),('##.......#'),(''),('Tile 1433:'),('...##..##.'),('.###....##'),('#..#.....#'),('...#......'),('..........'),('#......#.#'),('........##'),('#.#....#..'),('#.#.#..#.#'),('##..####..'),(''),('Tile 3361:'),('####......'),('##..#..#..'),('#.##...##.'),('#..#..#..#'),('#....#.#.#'),('...#.#....'),('..#.#...##'),('#...#..#..'),('..##..#.#.'),('.....##..#'),(''),('Tile 1123:'),('#.#..#..#.'),('##....#...'),('##..#....#'),('###.......'),('.##...#..#'),('#........#'),('.......###'),('..##...#..'),('.##.#....#'),('.###....#.'),(''),('Tile 2131:'),('.#.##..##.'),('#...#..###'),('#.##.#..#.'),('#.##......'),('.....###..'),('#.#.#...#.'),('.#.###...#'),('#.#..#.##.'),('####.....#'),('...#.##.#.'),(''),('Tile 1093:'),('.#.#.##..#'),('..#.#.....'),('.#.###...#'),('##...#...#'),('..#...##..'),('#..##.....'),('##.#....##'),('.###.....#'),('##.#...#.#'),('#....#....'),(''),('Tile 3761:'),('###.#...#.'),('.#..#....#'),('###......#'),('......#..#'),('#....#...#'),('##.###..#.'),('#.#..##...'),('.....##...'),('###......#'),('.######.#.'),(''),('Tile 3323:'),('....##...#'),('.....#....'),('##.....##.'),('#..#.....#'),('.....#...#'),('.#...##.##'),('........#.'),('#....#.#..'),('#....#.#.#'),('#...#..#..'),(''),('Tile 3061:'),('####.##.#.'),('#....#.###'),('....###...'),('#.....#.#.'),('...##....#'),('#.........'),('...#...#..'),('........##'),('.#....#..#'),('#..#.###.#'),(''),('Tile 2749:'),('#.##.#....'),('......#..#'),('###.#..#.#'),('#..###.#.#'),('.........#'),('#.........'),('#.##...#..'),('........#.'),('.#.#......'),('.#.#....#.'),(''),('Tile 1627:'),('..##.#..#.'),('.......#.#'),('.###.....#'),('###....#.#'),('##........'),('#...#...##'),('#........#'),('....#.#...'),('#.....#..#'),('#..##.##..'),(''),('Tile 2557:'),('.###.#####'),('...#.#..#.'),('#.#...#..#'),('#...#.##..'),('..........'),('....#.#...'),('...#...#.#'),('#..##.#..#'),('##..#.#...'),('.#.###..#.'),(''),('Tile 1871:'),('###....##.'),('#..#.##.#.'),('..#.#..##.'),('#..#...#.#'),('#........#'),('..#..#..#.'),('#......#..'),('......#.##'),('......##.#'),('.#.##...##'),(''),('Tile 3301:'),('.#.##.....'),('.#.#.#..##'),('.....#..##'),('#.##......'),('#....#....'),('.###..#..#'),('##.##....#'),('.........#'),('#.#..#..##'),('#..#..##.#'),(''),('Tile 2633:'),('#####..##.'),('#.#.......'),('#...#....#'),('###.##...#'),('#.......##'),('#...#.....'),('#........#'),('#......#.#'),('.........#'),('...#....#.'),(''),('Tile 3467:'),('#.###....#'),('..........'),('#.....#.##'),('.....#.#.#'),('.#.#.#.#.#'),('.##.####.#'),('.........#'),('.#.##....#'),('#....##...'),('.#.##.#...'),(''),('Tile 3253:'),('.####.#..#'),('...##.....'),('...#......'),('..#....#.#'),('##.##...##'),('##........'),('.......#..'),('##.#...#..'),('.........#'),('.####..#.#'),(''),('Tile 1459:'),('.....###..'),('#.##..####'),('#..###.#.#'),('#.....#.##'),('..#.......'),('.##.....##'),('..#...#..#'),('...#...#..'),('#...#....#'),('...#.#.###'),(''),('Tile 3529:'),('#.##..#..#'),('.....###..'),('...#....##'),('#........#'),('#.#..#...#'),('.#...##..#'),('#....#.#..'),('#.#.#...#.'),('.#........'),('#.###..#..'),(''),('Tile 1483:'),('.#.###.##.'),('......##..'),('..#......#'),('..........'),('......##..'),('...##.##..'),('..#....#..'),('#..#..##..'),('#.#.#.....'),('..#.######'),(''),('Tile 3613:'),('#.##..#.##'),('......####'),('#..#......'),('.....#...#'),('#.#.....##'),('#...#....#'),('#..#....#.'),('#.#.....#.'),('.###...#..'),('#.....#.##'),(''),('Tile 3517:'),('.#..#.....'),('.#...#..#.'),('###.#..#..'),('#....#..##'),('#.##..#...'),('......#..#'),('##.....##.'),('#.........'),('........##'),('........#.'),(''),('Tile 1493:'),('#..#......'),('#.#.##.#..'),('..#......#'),('#..#.....#'),('#.#.###...'),('.##....#.#'),('#.#......#'),('...#......'),('#.......##'),('#..###..##'),(''),('Tile 1753:'),('..#..#..##'),('##.......#'),('.#...#....'),('#.##....##'),('#....#...#'),('......#...'),('.....#....'),('......#..#'),('..##...#.#'),('##.#.#.##.'),(''),('Tile 2843:'),('###..#..##'),('....#...##'),('##..#.....'),('.....##...'),('#.#......#'),('.........#'),('#..#.....#'),('..#..#.#.#'),('#.#.#.##..'),('###..####.'),('')),
--WITH vals AS(VALUES('Tile 2311:'),('..##.#..#.'),('##..#.....'),('#...##..#.'),('####.#...#'),('##.##.###.'),('##...#.###'),('.#.#.#..##'),('..#....#..'),('###...#.#.'),('..###..###'),(''),('Tile 1951:'),('#.##...##.'),('#.####...#'),('.....#..##'),('#...######'),('.##.#....#'),('.###.#####'),('###.##.##.'),('.###....#.'),('..#.#..#.#'),('#...##.#..'),(''),('Tile 1171:'),('####...##.'),('#..##.#..#'),('##.#..#.#.'),('.###.####.'),('..###.####'),('.##....##.'),('.#...####.'),('#.##.####.'),('####..#...'),('.....##...'),(''),('Tile 1427:'),('###.##.#..'),('.#..#.##..'),('.#.##.#..#'),('#.#.#.##.#'),('....#...##'),('...##..##.'),('...#.#####'),('.#.####.#.'),('..#..###.#'),('..##.#..#.'),(''),('Tile 1489:'),('##.#.#....'),('..##...#..'),('.##..##...'),('..#...#...'),('#####...#.'),('#..#.#.#.#'),('...#.#.#..'),('##.#...##.'),('..##.##.##'),('###.##.#..'),(''),('Tile 2473:'),('#....####.'),('#..#.##...'),('#.##..#...'),('######.#.#'),('.#...#.#.#'),('.#########'),('.###.#..#.'),('########.#'),('##...##.#.'),('..###.#.#.'),(''),('Tile 2971:'),('..#.#....#'),('#...###...'),('#.#.###...'),('##.##..#..'),('.#####..##'),('.#..####.#'),('#..#.#..#.'),('..####.###'),('..#.#.###.'),('...#.#.#.#'),(''),('Tile 2729:'),('...#.#.#.#'),('####.#....'),('..#.#.....'),('....#..#.#'),('.##..##.#.'),('.#.####...'),('####.#.#..'),('##.####...'),('##..#.##..'),('#.##...##.'),(''),('Tile 3079:'),('#.#.#####.'),('.#..######'),('..#.......'),('######....'),('####.#..#.'),('.#...#.##.'),('#.#####.##'),('..#.###...'),('..#.......'),('..#.###...')),
--get the real tile number
tiles AS (
    SELECT column1,
           row_number() over() AS line_id,
           split_part(split_part(column1,' ',2),':',1) as tile_id
      FROM vals
),
-- get the tiles with real id
tiles2 AS (
    SELECT t.column1,
           COALESCE(NULLIF(t.tile_id,''), ttid.tile_id) as tile_id,
           t.line_id
      FROM tiles t
      JOIN LATERAL (SELECT max(t2.line_id::int) as tile_id_line FROM tiles t2 WHERE t2.line_id<t.line_id AND t2.tile_id!='') tid ON TRUE
      JOIN LATERAL (SELECT t3.tile_id FROM tiles t3 WHERE t3.line_id=tid.tile_id_line) ttid ON TRUE
      WHERE column1!=''
        AND NOT column1 like 'Tile%'
   ORDER BY tile_id,
            line_id
),
-- Numbering lines
tiles3 AS (
    SELECT column1 as item,
           tile_id,
           row_number() over(PARTITION BY tile_id) as line_id
      FROM tiles2
  ORDER BY tile_id, line_id
),
-- Need only borders
tiles_with_borders AS (
    SELECT t.tile_id,
           t.item as up,
           t_bottom.item as down,
           t_left.item as "left",
           t_right.item as "right"
      FROM tiles3 t
      JOIN tiles3 t_bottom ON t_bottom.tile_id=t.tile_id AND t_bottom.line_id=10
      JOIN LATERAL (SELECT ARRAY_TO_STRING(array_agg(substring(item,1,1)),'','') as item FROM tiles3 tl WHERE tl.tile_id=t.tile_id) AS t_left ON TRUE
      JOIN LATERAL (SELECT ARRAY_TO_STRING(array_agg(substring(item,10,10)),'','') as item FROM tiles3 tr WHERE tr.tile_id=t.tile_id) AS t_right ON TRUE
     WHERE t.line_id=1
),
--generate all posible orientations of tiles
all_tiles_unflipped AS (
    SELECT tile_id,
           tile_id::varchar||'+0' as tile_id_orientation,
           '0' as orientation,
           up,
           "right",
           down,
           "left"
      FROM tiles_with_borders

     UNION ALL

     SELECT tile_id,
            tile_id::varchar||'+90' as tile_id_orientation,
            90 as orientation,
            reverse("left") as up,
            up as "right",
            reverse("right") as down,
            down as "left"
       FROM tiles_with_borders

     UNION ALL

     SELECT tile_id,
            tile_id::varchar||'+180' as tile_id_orientation,
            180 as orientation,
            reverse(down) as up,
            reverse("left") as "right",
            reverse(up) as down,
            reverse("right") as "left"
       FROM tiles_with_borders

     UNION ALL

     SELECT tile_id,
            tile_id::varchar||'+270' as tile_id_orientation,
            270 as orientation,
            "right" as up,
            reverse(down) as "right",
            "left" as down,
            reverse(up) as "left"
       FROM tiles_with_borders
),
all_tiles AS (
    SELECT tile_id,
           tile_id_orientation,
           up,
           "right",
           down,
           "left"
      FROM all_tiles_unflipped

     UNION ALL

    SELECT tile_id,
           tile_id_orientation||'R',
           reverse(up),
           "left",
           reverse(down),
           "right"
      FROM all_tiles_unflipped

     UNION ALL

    SELECT tile_id,
           tile_id_orientation||'U',
           down,
           reverse("left"),
           up,
           reverse("right")
      FROM all_tiles_unflipped
)

SELECT tile_id,
       tile_id_orientation,
       up,
       "right",
       down,
       "left"
  INTO TEMPORARY TABLE tiles
  FROM all_tiles;

SELECT sqrt(count(DISTINCT tile_id)) as size
  INTO TEMPORARY TABLE square_size
  FROM tiles;

WITH RECURSIVE tile_lines AS (
    SELECT ARRAY[tile_id] as used_ones,
           1 as iter,
           "right",
           "down",
           "up",
           row_number() over() as line_combination_id,
           tile_id as line_start,
           tile_id as line_end
      FROM tiles

 UNION ALL

   SELECT array_append(used_ones, t.tile_id),
          iter+1,
          t."right",
          tl."down"||t."down",
          tl."up"||t."up",
          tl.line_combination_id,
          tl.line_start,
          t.tile_id
     FROM tile_lines tl
     JOIN tiles t ON tl.right=t.left AND NOT (t.tile_id=ANY(used_ones))
     CROSS JOIN square_size s
    WHERE iter<s.size
)
SELECT used_ones,
       down,
       up,
       line_combination_id,
       line_start,
       line_end
  INTO TEMPORARY TABLE tile_lines
  FROM tile_lines, square_size s
 WHERE iter=s.size;

 WITH RECURSIVE recursive_squaring AS (
     SELECT used_ones,
            down,
            1 as iter,
            line_start as l1_start,
            line_end as l1_end,
            line_start as lf_start,
            line_end as lf_end
       FROM tile_lines

      UNION ALL

     SELECT rs.used_ones||tl.used_ones,
            tl.down,
            iter+1,
            rs.l1_start,
            rs.l1_end,
            tl.line_start,
            tl.line_end
       FROM recursive_squaring rs
       JOIN tile_lines tl ON rs.down=tl.up
       CROSS JOIN square_size s
      WHERE NOT rs.used_ones && tl.used_ones
      AND iter<=s.size
 )

 SELECT l1_start::bigint*l1_end::bigint*lf_start::bigint*lf_end::bigint FROM recursive_squaring CROSS JOIN square_size s where iter=s.size;

 rollback;
